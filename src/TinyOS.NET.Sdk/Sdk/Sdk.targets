<?xml version="1.0" encoding="utf-8"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

	<Import Project="$(MSBuildThisFileDirectory)..\build\TinyOS.NET.Sdk.targets"/>

	<!-- Implicit bottom import -->
	<Import Sdk="Microsoft.NET.Sdk" Project="Sdk.targets" />

	<Choose>
	<When Condition="'$(_IsPublishing)' == 'true'">
		<PropertyGroup>
			<VerifyHash>true</VerifyHash>
			<IsPublished>true</IsPublished>
			<SourceDirectory>$(MSBuildProjectDirectory)\$(OutputPath)\publish</SourceDirectory>
		</PropertyGroup>
	</When>
	<Otherwise>
		<PropertyGroup>
			<IsPublished>false</IsPublished>
			<SourceDirectory>$(MSBuildProjectDirectory)\$(OutputPath)</SourceDirectory>
		</PropertyGroup>
	</Otherwise>
	</Choose>

	<PropertyGroup>
		<BuildDependsOn>$(BuildDependsOn);RemoteDeploy</BuildDependsOn>
		<CleanDependsOn>$(CleanDependsOn);RemoteClean</CleanDependsOn>
	</PropertyGroup>

	<PropertyGroup>
    	<RunCommand>dotnet</RunCommand>
    	<RunArguments>build</RunArguments>
	</PropertyGroup>

	<PropertyGroup>
		<_SdkTasksAssembly>$(MSBuildThisFileDirectory)..\tools\netstandard2.0\TinyOS.NET.Sdk.dll</_SdkTasksAssembly>
	</PropertyGroup>

	<UsingTask TaskName="DeployTask" AssemblyFile="$(_SdkTasksAssembly)" />
	<UsingTask TaskName="CleanTask" AssemblyFile="$(_SdkTasksAssembly)" />

	<Target Name="RemoteDeploy">
		<DeployTask 
		SourceDirectory="$(SourceDirectory)" 
		ProjectName="$(ProjectName)" 
		ProjectId="$(ProjectId)" 
		DeviceUrl="$(DeviceUrl)"
		IsPublished="$(IsPublished)"
		VerifyHash="$(VerifyHash)" />
	</Target>

	<Target Name="RemoteClean">
		<CleanTask 
		SourceDirectory="$(MSBuildProjectDirectory)\$(OutputPath)" 
		ProjectName="$(ProjectName)" 
		ProjectId="$(ProjectId)" 
		DeviceUrl="$(DeviceUrl)" />
	</Target>

</Project>
